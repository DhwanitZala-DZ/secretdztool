<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DHWANIT ZALA STUDIO | Vercel Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;700;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Plus Jakarta Sans', sans-serif; background: #020202; color: #fff; overflow-x: hidden; }
        .glass-panel { background: rgba(10, 10, 10, 0.8); backdrop-filter: blur(30px); border: 1px solid rgba(255, 255, 255, 0.05); }
        .neon-glow { color: #ff0055; text-shadow: 0 0 25px rgba(255, 0, 85, 0.7); }
        .btn-main { background: linear-gradient(90deg, #ff0055, #ff5e00); transition: 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        .btn-main:hover { transform: scale(1.02); box-shadow: 0 0 40px rgba(255, 0, 85, 0.5); }
        .preview-window { width: 100%; aspect-ratio: 16/9; background: #000; border-radius: 24px; border: 1px solid #222; overflow: hidden; display: flex; align-items: center; justify-content: center; position: relative; }
        @keyframes rotate { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        .spinner { width: 30px; height: 30px; border: 3px solid rgba(255,255,255,0.1); border-top-color: #ff0055; border-radius: 50%; animation: rotate 1s linear infinite; }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4">

    <div class="glass-panel max-w-5xl w-full rounded-[60px] p-12 text-center relative shadow-2xl border border-zinc-800">
        <div class="mb-10">
            <h1 class="text-7xl font-black tracking-tighter italic uppercase">DHWANIT ZALA <span class="neon-glow">STUDIO</span></h1>
            <p class="text-zinc-500 mt-4 tracking-[0.5em] font-bold text-[10px] uppercase">Vercel Deployment â€¢ Bypass Edition</p>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-10 items-center">
            <div class="space-y-6 text-left">
                <h2 class="text-2xl font-bold italic">Paste Wallpaper Link</h2>
                <input type="text" id="targetUrl" placeholder="https://www.wallpaperengine.space/..." 
                       class="w-full p-6 bg-zinc-900 border border-zinc-800 rounded-[30px] text-white focus:outline-none focus:border-pink-600 transition-all">
                
                <button id="fetchBtn" class="btn-main w-full p-6 text-white rounded-[30px] font-black text-xl uppercase tracking-widest">
                    GENERATE SOURCE
                </button>

                <div id="statusBox" class="hidden p-6 bg-zinc-900/50 rounded-[30px] border border-dashed border-zinc-700">
                    <div id="loader" class="flex items-center gap-4">
                        <div class="spinner"></div>
                        <span class="text-pink-500 font-bold uppercase text-xs tracking-widest">Unmasking Video Source...</span>
                    </div>
                    <div id="fileFound" class="hidden text-center">
                        <p class="text-green-500 font-black text-sm mb-4 italic uppercase">1080p Stream Decoded</p>
                        <button onclick="openFinal()" class="bg-white text-black px-10 py-3 rounded-full font-black hover:bg-pink-600 hover:text-white transition-all uppercase text-xs">
                            Download Now
                        </button>
                    </div>
                </div>
            </div>

            <div class="preview-window shadow-inner">
                <div id="previewText" class="text-zinc-700 font-black text-sm uppercase italic">Live Preview Area</div>
                <img id="previewImg" class="hidden w-full h-full object-cover" src="" alt="Wallpaper Preview">
            </div>
        </div>
    </div>

    <div id="creditModal" class="hidden fixed inset-0 bg-black/98 flex items-center justify-center z-[9999]">
        <div class="bg-white text-black p-16 rounded-[70px] text-center max-w-sm w-full mx-4 shadow-2xl">
            <p class="text-[9px] font-black tracking-widest text-zinc-400 uppercase mb-2">Developed By</p>
            <a href="https://www.instagram.com/dhwanitzala" target="_blank" class="block text-4xl font-black mb-6 text-pink-600">@dhwanitzala</a>
            <p class="text-zinc-500 text-[11px] mb-8 leading-relaxed">
                Source located! Opening in a new tab.<br>
                <b>Note:</b> If it opens as a player, copy the URL and use <b>VLC</b> for highest 4K quality.
            </p>
            <button onclick="location.reload()" class="w-full bg-black text-white p-5 rounded-2xl font-black uppercase text-[10px] tracking-widest">Close Studio</button>
        </div>
    </div>

    <script>
        let finalUrl = "";
        
        // We use a different, more stable CORS proxy for Vercel
        const PROXY = "https://api.allorigins.win/raw?url=";

        document.getElementById('fetchBtn').onclick = async () => {
            const input = document.getElementById('targetUrl').value;
            const statusBox = document.getElementById('statusBox');
            const loader = document.getElementById('loader');
            const fileFound = document.getElementById('fileFound');
            const previewText = document.getElementById('previewText');
            const previewImg = document.getElementById('previewImg');

            if (!input) return alert("Please paste a link!");

            statusBox.classList.remove('hidden');
            loader.classList.remove('hidden');
            fileFound.classList.add('hidden');

            try {
                // Fetching via RAW proxy to avoid JSON parsing errors
                const response = await fetch(`${PROXY}${encodeURIComponent(input)}`);
                if (!response.ok) throw new Error('Proxy unreachable');
                
                const html = await response.text();

                // 1. Extract Preview Thumbnail
                const thumbMatch = html.match(/https:\/\/video\.squarespace-cdn\.com\/content\/v1\/[a-zA-Z0-9_-]+\/[a-zA-Z0-9_-]+\/thumbnail/);
                if (thumbMatch) {
                    previewImg.src = thumbMatch[0];
                    previewImg.classList.remove('hidden');
                    previewText.classList.add('hidden');
                }

                // 2. Extract Video Source (Playlist)
                // We look for the Playback URL hidden in the Squarespace config
                const videoMatch = html.match(/videoPlaybackUrl(&quot;|"):(&quot;|")([^&"]+)/);
                
                if (videoMatch) {
                    let rawUrl = videoMatch[3];
                    // Clean the encoded slashes
                    finalUrl = rawUrl.replace(/\\u002f/g, '/').replace(/&amp;/g, '&');
                    
                    loader.classList.add('hidden');
                    fileFound.classList.remove('hidden');
                } else if (thumbMatch) {
                    // Fail-safe: Manually construct playlist from thumbnail
                    finalUrl = thumbMatch[0].replace('/thumbnail', '/playlist.m3u8');
                    loader.classList.add('hidden');
                    fileFound.classList.remove('hidden');
                } else {
                    alert("Could not find the video source. Please ensure it's a valid link.");
                    statusBox.classList.add('hidden');
                }
            } catch (e) {
                console.error(e);
                alert("CORS Proxy Busy. Try again in 5 seconds.");
                statusBox.classList.add('hidden');
            }
        };

        function openFinal() {
            document.getElementById('creditModal').classList.remove('hidden');
            window.open(finalUrl, '_blank');
        }
    </script>
</body>
</html>
